# Mirror Azure DevOps â†’ GitHub 
# Pushing on main or develop only
trigger:
  branches:
    include:
      - main
      - dev

pool:
  name: Default

steps:
  - checkout: self
    fetchDepth: 0
    persistCredentials: true

  - script: |
      git config user.name "ado-mirror-bot"
      git config user.email "ado-mirror-bot@users.noreply.github.com"
    displayName: "Configurar identidad Git"

  - script: |
      echo ===> Getting source URL (ADO)
      for /f "delims=" %%i in ('git config --get remote.origin.url') do set SRC_URL=%%i
      echo Source: %SRC_URL%

      echo ===> Cloning in mirror mode...
      git clone --mirror "%SRC_URL%" repo_mirror
      cd repo_mirror

      echo ===> Setting destination URL (GitHub)
      set GH_URL=https://%GITHUB_PAT%@github.com/%USUARIO_GITHUB%/%REPO_GITHUB%.git
      echo Destination: %GH_URL%

      echo ===> Pushing to GitHub...
      git push --mirror "%GH_URL%"
    displayName: "Mirror to GitHub complete"
